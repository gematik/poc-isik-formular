<!doctype html>
<html lang="de">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LHC-Forms Demo ‚Äì FHIR Questionnaire Renderer</title>
  <script type="module" crossorigin src="/poc-isik-formular/assets/main-YXt_IhdT.js"></script>
  <link rel="modulepreload" crossorigin href="/poc-isik-formular/assets/modulepreload-polyfill-B5Qt9EMX.js">
  <link rel="modulepreload" crossorigin href="/poc-isik-formular/assets/footer-z8lHOjHC.js">
  <link rel="modulepreload" crossorigin href="/poc-isik-formular/assets/smart-aX28uhIB.js">
  <link rel="stylesheet" crossorigin href="/poc-isik-formular/assets/footer-BSV1lCnU.css">
  <link rel="stylesheet" crossorigin href="/poc-isik-formular/assets/main-BH4U6DQn.css">
  <link rel="stylesheet" crossorigin href="/poc-isik-formular/assets/resolve-C4nX2P5b.css">
</head>

<body>
  <div class="demo-banner" role="status">Hinweis: Dies ist eine Demo-Anwendung.</div>
  <header>
    <h1>üéõÔ∏è LHC-Forms Minimal Demo - FHIR Questionnaire Renderer</h1>
  </header>
  <main>
    <section class="panel" id="leftPanel">
      <div id="smartContextInfo" class="smart-context hidden" aria-live="polite">
        <div class="smart-context__title">SMART Kontext</div>
        <div class="smart-context__rows">
          <div class="smart-context__row">
            <span class="smart-context__label">Benutzer</span>
            <span class="smart-context__value" id="smartContextUser">‚Äì</span>
          </div>
          <div class="smart-context__row">
            <span class="smart-context__label">Patient</span>
            <span class="smart-context__value" id="smartContextPatient">‚Äì</span>
          </div>
          <div class="smart-context__row">
            <span class="smart-context__label">Encounter</span>
            <span class="smart-context__value" id="smartContextEncounter">‚Äì</span>
          </div>
        </div>
      </div>
      <h2>Quelle w√§hlen</h2>
      <div class="body stack">
        <div class="stack collapsible collapsed" data-title="Questionnaire per URL">
          <label for="fhirUrl">Questionnaire per URL (FHIR JSON)</label>
          <div class="row">
            <input id="fhirUrl" type="text"
              placeholder="z.B. http://localhost:8080/fhir/Questionnaire/123?_format=json" />
            <button id="btnLoadUrl" class="btn">Laden</button>
          </div>
          <div class="hint">Tipp: Mit HAPI lokal:
            <code>http://localhost:8080/fhir/Questionnaire/{id}?_format=json</code>
          </div>
        </div>

        <div class="stack collapsible" data-title="Vom FHIR-Server per ID laden">
          <label for="fhirBasePreset">Vom FHIR-Server per ID laden</label>
          <div class="row">
            <select id="fhirBasePreset">
              <option value="hl7">HL7 Deutschland Public Test Server</option>
              <option value="simplifier">Simplifier ISiK Stufe 5 Server</option>
              <option value="miiPro">Simplifier MII Erweiterungsmodul PRO 2025</option>
              <option value="custom">Anderer</option>
            </select>
          </div>
          <div class="row">
            <div class="stack" style="width:100%">
              <label for="fhirBase">FHIR Base URL</label>
              <input id="fhirBase" type="text" placeholder="FHIR Base URL, z.‚ÄØB. http://localhost:8080/fhir" />
            </div>
          </div>
          <div class="row row3">
            <div class="stack">
              <label for="qId">Questionnaire ID</label>
              <input id="qId" type="text" placeholder="Questionnaire ID" />
            </div>
            <button id="btnLoadServer" class="btn">Fetch</button>
            <button id="btnBrowse" class="btn secondary"
              title="Questionnaires auf dem Server durchsuchen">Browse</button>
          </div>
        </div>

        <div class="stack collapsible" data-title="Launch Context">
          <label>Launch Context (optional)</label>
          <label for="prepopBase">Prepopulation FHIR Base</label>
          <input id="prepopBase" type="text" placeholder="Prepopulation FHIR Base (optional)" />
          <div class="row row3">
            <div class="stack">
              <label for="patientId">Patient ID</label>
              <input id="patientId" type="text" placeholder="Patient ID" />
            </div>
            <button id="btnBrowsePatient" class="btn secondary"
              title="Patienten auf dem Server durchsuchen">Browse</button>
          </div>
          <div class="row row3">
            <div class="stack">
              <label for="encounterId">Encounter ID</label>
              <input id="encounterId" type="text" placeholder="Encounter ID" />
            </div>
            <button id="btnBrowseEncounter" class="btn secondary"
              title="Encounters auf dem Server durchsuchen">Browse</button>
          </div>
          <div class="row row3 hidden">
            <div class="stack">
              <label for="userId">User/Practitioner ID</label>
              <input id="userId" type="text" placeholder="User/Practitioner ID" />
            </div>
          </div>
          <div class="row">
            <button id="btnSetContext" class="btn secondary">Kontext setzen</button>
          </div>
          <div class="hint">Nutzt die FHIR Base aus dem Feld oben, falls die URL hier leer gelassen wird. Kontext
            beeinflusst Prepopulation (SDC).</div>
        </div>

        <div class="stack collapsible" data-title="Questionnaire JSON">
          <label for="jsonArea">Questionnaire JSON (einf√ºgen)</label>
          <textarea id="jsonArea" placeholder='{"resourceType":"Questionnaire","status":"active", ...}'></textarea>
          <div class="actions">
            <button id="btnRenderJson" class="btn">Rendern</button>
            <button id="btnLoadSample" class="btn secondary">Beispiel einf√ºgen</button>
            <button id="btnClear" class="btn ghost">Leeren</button>
          </div>
        </div>

        <div class="hint" id="status"></div>

        <div class="stack collapsible" data-title="Link mit aktuellen Parametern">
          <label for="shareUrl">Link mit aktuellen Parametern</label>
          <div class="row">
            <input id="shareUrl" type="text" readonly />
            <button id="btnCopyUrl" class="btn secondary" title="In Zwischenablage kopieren">Kopieren</button>
          </div>
          <div class="hint">Beinhaltet q oder base/id, optional prepopBase sowie Patient/Encounter/User und minimal.
          </div>
        </div>
      </div>
    </section>

    <section class="panel" id="renderPanel">
      <h2>Gerendertes Formular</h2>
      <div class="body">
        <div id="renderTarget"></div>
        <div id="exportActions" class="actions hidden" style="margin-top: 10px;">
          <button id="btnExportQR" class="btn secondary"
            title="√ñffnet die extrahierte QuestionnaireResponse in neuem Tab">Zeige QuestionnaireResponse</button>
          <button id="btnExportQROBS" class="btn"
            title="√ñffnet QuestionnaireResponse und Observations in neuem Tab">Zeige QR + Observations</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal f√ºr Browse-Suchergebnisse -->
  <div id="browseModal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="browseTitle">
    <div class="modal">
      <div class="modal-header">
        <h3 id="browseTitle">Suche</h3>
        <button id="browseClose" class="btn ghost" title="Schlie√üen">Schlie√üen</button>
      </div>
      <div class="modal-body">
        <div id="browseInfo" class="hint"></div>
        <div id="browseStatus" class="hint"></div>
        <div id="browseSearchRow" class="row" style="gap:8px; align-items:center;">
          <input id="browseSearch" type="text" placeholder="Suche" />
          <button id="browseSearchBtn" class="btn secondary">Suchen</button>
        </div>
        <div id="browseResults" class="results-grid"></div>
        <div id="browseControls" class="actions" style="margin-top: 8px; display: none; gap: 8px; align-items: center;">
          <button id="browsePrev" class="btn secondary" disabled>Zur√ºck</button>
          <span id="browsePage" class="hint">Seite 1</span>
          <button id="browseNext" class="btn" disabled>Weiter</button>
        </div>
      </div>
    </div>
  </div>

  <div id="footer-root"></div>

</body>

</html>
